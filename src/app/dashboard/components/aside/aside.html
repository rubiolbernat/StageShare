<!-- Aside Menu -->
<aside
  id="aside"
  (window:resize)="onResize($event)"
  [class.expanded]="getAside()"
  [class.mobile]="getAside()"
>
  <div class="logo" >
    <div class="logo-icon" routerLink="/">
      <i class="fas"
        ><img src="Stage-Share.png" height="30px" alt="Stage Share Logo"
      /></i>
    </div>
    <div class="logo-text" routerLink="/">Stage Share</div>
    <button class="toggle-btn" id="toggle-btn" (click)="toggleAside()">
      <i class="fas">
        <svg
          class="toggle-icon"
          [class.rotated]="getAside()"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="m10 16 4-4-4-4"
          />
        </svg>
      </i>
    </button>
  </div>
  <div class="menu">
    <div class="menu-item" routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
      <div class="menu-icon">
        <i class="fas fa-home"
          ><svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M11.293 3.293a1 1 0 0 1 1.414 0l6 6 2 2a1 1 0 0 1-1.414 1.414L19 12.414V19a2 2 0 0 1-2 2h-3a1 1 0 0 1-1-1v-3h-2v3a1 1 0 0 1-1 1H7a2 2 0 0 1-2-2v-6.586l-.293.293a1 1 0 0 1-1.414-1.414l2-2 6-6Z"
              clip-rule="evenodd"
            />
          </svg>
        </i>
      </div>
      <div class="menu-text">Inici</div>
    </div>
    <hr />
    <div
      class="menu-item"
      id="reports-item"
      [class.expanded]="getSubmenuState(0)"
      (click)="toggleSubmenu(0)"
      routerLink="/home"
      routerLinkActive="active"
    >
      <div class="menu-icon">
        <i class="fas"
          ><svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M9 2.221V7H4.221a2 2 0 0 1 .365-.5L8.5 2.586A2 2 0 0 1 9 2.22ZM11 2v5a2 2 0 0 1-2 2H4v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2h-7ZM8 16a1 1 0 0 1 1-1h6a1 1 0 1 1 0 2H9a1 1 0 0 1-1-1Zm1-5a1 1 0 1 0 0 2h6a1 1 0 1 0 0-2H9Z"
              clip-rule="evenodd"
            />
          </svg>
        </i>
      </div>
      <div class="menu-text">Informes</div>
      <div class="menu-arrow">
        <i class="fas fa-chevron-right"
          ><svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m10 16 4-4-4-4"
            />
          </svg>
        </i>
      </div>
      <div class="submenu">
        <div class="submenu-item active">
          <div class="submenu-icon"><i class="fas fa-circle"></i></div>
          Informes de vendes
        </div>
        <div class="submenu-item">
          <div class="submenu-icon"><i class="fas fa-circle"></i></div>
          Informes de clients
        </div>
        <div class="submenu-item">
          <div class="submenu-icon"><i class="fas fa-circle"></i></div>
          Informes financers
        </div>
      </div>
    </div>
    <div class="menu-item" routerLink="/venues" routerLinkActive="active">
      <div class="menu-icon">
        <i class="fas"
          ><svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M7.50001 6.49476c-.00222.00067-.00443.00134-.00665.00202-1.36964.41615-2.57189 1.22541-3.40555 1.89335-.42318.33907-.76614.65372-1.00483.88517-.11959.11596-.21369.21169-.2793.27999-.03283.03417-.05857.06153-.07687.08118l-.02184.02361-.00665.00728-.00225.00247-.00152.00167c-.23565.26049-.31736.6255-.21524.9616l1.88966 6.2193c.28122.9255.90731 1.6328 1.59535 2.159.68925.5272 1.4966.9166 2.25327 1.198.76111.2832 1.50814.4708 2.10341.5791.2973.054.5684.0904.7934.1077.1117.0085.2238.0133.3286.0113.0814-.0016.2434-.0076.4111-.0586.1678-.051.3057-.1361.3743-.18.0882-.0566.1786-.123.2667-.1923.1774-.1395.3824-.3205.5994-.5309-.076-.0369-.1525-.0755-.2297-.1152-.6068-.312-1.3433-.7546-2.0675-1.3064-.4898-.3733-1.01068-.8242-1.48988-1.3492-.28662.4467-.87678.5935-1.34124.3253-.47829-.2761-.64217-.8877-.36603-1.366.01906-.033.03873-.0675.05915-.1034.10835-.1902.23774-.4173.40797-.6498C7.73454 14.6941 7.5 13.8935 7.5 13V6.5l.00001-.00524ZM5.72195 11.0461c-.52844.1606-.82665.7191-.6661 1.2476.16056.5284.7191.8266 1.24753.6661l.00957-.003c.52843-.1605.82665-.7191.66609-1.2475-.16056-.5284-.7191-.8266-1.24753-.6661l-.00956.0029Z"
              clip-rule="evenodd"
            />
            <path
              fill-rule="evenodd"
              d="M15 4c-1.4315 0-2.8171.42479-3.8089.82152-.5035.2014-.9231.40276-1.21876.55482-.14814.07618-.26601.14043-.34864.1867-.04134.02315-.07393.04184-.09715.05533l-.02775.01624-.00849.00502-.00286.00171-.00195.00117C9.1843 5.82323 9 6.14874 9 6.5V13c0 .9673.39342 1.8261.89875 2.5296.50625.7048 1.16555 1.312 1.80765 1.8013.646.4922 1.3062.8889 1.8442 1.1655.2688.1382.5176.2518.7279.3338.1044.0407.2102.0778.3111.1063.0784.0222.2351.0635.4104.0635.1753 0 .332-.0413.4104-.0635.1009-.0285.2067-.0656.3111-.1063.2103-.082.4591-.1956.7279-.3338.538-.2766 1.1982-.6733 1.8442-1.1655.6421-.4893 1.3014-1.0965 1.8076-1.8013C20.6066 14.8261 21 13.9673 21 13V6.5c0-.35126-.1852-.67728-.4864-.85801l-.001-.00065-.0029-.00171-.0085-.00502-.0278-.01624c-.0232-.01349-.0558-.03218-.0971-.05533-.0826-.04627-.2005-.11052-.3486-.1867-.2957-.15206-.7153-.35342-1.2188-.55482C17.8171 4.42479 16.4315 4 15 4Zm5 2.5.5136-.85801S20.5145 5.64251 20 6.5ZM13 7c-.5523 0-1 .44772-1 1s.4477 1 1 1h.01c.5523 0 1-.44772 1-1s-.4477-1-1-1H13Zm4 0c-.5523 0-1 .44772-1 1s.4477 1 1 1h.01c.5523 0 1-.44772 1-1s-.4477-1-1-1H17Zm-4.7071 4.2929c-.3905.3905-.3905 1.0237 0 1.4142.0269.027.0549.0552.0838.0845.4776.4831 1.243 1.2574 2.6233 1.2574 1.3803 0 2.1457-.7743 2.6232-1.2573.029-.0294.057-.0576.0839-.0846.3905-.3905.3905-1.0237 0-1.4142-.3905-.3905-1.0237-.3905-1.4142 0-.5293.5293-.757.7561-1.2929.7561-.5359 0-.7636-.2268-1.2929-.7561-.3905-.3905-1.0237-.3905-1.4142 0Z"
              clip-rule="evenodd"
            />
          </svg>
        </i>
      </div>
      <div class="menu-text">Stage Search</div>
    </div>
    <div
      class="menu-item"
      id="management-item"
      [class.expanded]="getSubmenuState(1)"
      (click)="toggleSubmenu(1)"
    >
      <div class="menu-icon">
        <i class="fas"
          ><svg
            class="w-[23px] h-[23px] text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M9.586 2.586A2 2 0 0 1 11 2h2a2 2 0 0 1 2 2v.089l.473.196.063-.063a2.002 2.002 0 0 1 2.828 0l1.414 1.414a2 2 0 0 1 0 2.827l-.063.064.196.473H20a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-.089l-.196.473.063.063a2.002 2.002 0 0 1 0 2.828l-1.414 1.414a2 2 0 0 1-2.828 0l-.063-.063-.473.196V20a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-.089l-.473-.196-.063.063a2.002 2.002 0 0 1-2.828 0l-1.414-1.414a2 2 0 0 1 0-2.827l.063-.064L4.089 15H4a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h.09l.195-.473-.063-.063a2 2 0 0 1 0-2.828l1.414-1.414a2 2 0 0 1 2.827 0l.064.063L9 4.089V4a2 2 0 0 1 .586-1.414ZM8 12a4 4 0 1 1 8 0 4 4 0 0 1-8 0Z"
              clip-rule="evenodd"
            />
          </svg>
        </i>
      </div>
      <div class="menu-text">Gestió</div>
      <div class="menu-arrow">
        <i class="fas fa-chevron-right"
          ><svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            viewBox="0 0 24 24"
          >
            <path
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="m10 16 4-4-4-4"
            />
          </svg>
        </i>
      </div>
      <div class="submenu">
        <div class="submenu-item">
          <div class="submenu-icon"><i class="fas fa-circle"></i></div>
          Usuaris
        </div>
        <div class="submenu-item">
          <div class="submenu-icon"><i class="fas fa-circle"></i></div>
          Permisos
        </div>
        <div class="submenu-item">
          <div class="submenu-icon"><i class="fas fa-circle"></i></div>
          Configuració
        </div>
      </div>
    </div>
    <div class="menu-item">
      <div class="menu-icon">
        <i class="fas"
          ><svg
            class="w-[23px] h-[23px] text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M2.038 5.61A2.01 2.01 0 0 0 2 6v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6c0-.12-.01-.238-.03-.352l-.866.65-7.89 6.032a2 2 0 0 1-2.429 0L2.884 6.288l-.846-.677Z"
            />
            <path
              d="M20.677 4.117A1.996 1.996 0 0 0 20 4H4c-.225 0-.44.037-.642.105l.758.607L12 10.742 19.9 4.7l.777-.583Z"
            />
          </svg>
        </i>
      </div>
      <div class="menu-text">Missatges</div>
    </div>
    <div class="menu-item">
      <div class="menu-icon">
        <i class="fas"
          ><svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              fill-rule="evenodd"
              d="M7.05 4.05A7 7 0 0 1 19 9c0 2.407-1.197 3.874-2.186 5.084l-.04.048C15.77 15.362 15 16.34 15 18a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1c0-1.612-.77-2.613-1.78-3.875l-.045-.056C6.193 12.842 5 11.352 5 9a7 7 0 0 1 2.05-4.95ZM9 21a1 1 0 0 1 1-1h4a1 1 0 1 1 0 2h-4a1 1 0 0 1-1-1Zm1.586-13.414A2 2 0 0 1 12 7a1 1 0 1 0 0-2 4 4 0 0 0-4 4 1 1 0 0 0 2 0 2 2 0 0 1 .586-1.414Z"
              clip-rule="evenodd"
            />
          </svg>
        </i>
      </div>
      <div class="menu-text">Fixture finder</div>
    </div>
    <hr />
    <div class="menu-item">
      <div class="menu-icon">
        <i class="fas"
          ><svg
            class="w-6 h-6 text-gray-800 dark:text-white"
            aria-hidden="true"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="m12.75 20.66 6.184-7.098c2.677-2.884 2.559-6.506.754-8.705-.898-1.095-2.206-1.816-3.72-1.855-1.293-.034-2.652.43-3.963 1.442-1.315-1.012-2.678-1.476-3.973-1.442-1.515.04-2.825.76-3.724 1.855-1.806 2.201-1.915 5.823.772 8.706l6.183 7.097c.19.216.46.34.743.34a.985.985 0 0 0 .743-.34Z"
            />
          </svg>
        </i>
      </div>
      <div class="menu-text">My favourite</div>
    </div>
  </div>
</aside>
<script>
  // Tancar menú en fer clic fora en mòbil
  document.addEventListener("click", (e) => {
    if (
      window.innerWidth <= 768 &&
      !aside.contains(e.target) &&
      e.target !== mobileMenuBtn
    ) {
      aside.classList.remove("active");
    }
  });

  // Submenús del menú lateral
  const menuItemsWithSubmenu = document.querySelectorAll(
    ".menu-item:has(.submenu)"
  );

  menuItemsWithSubmenu.forEach((item) => {
    item.addEventListener("click", (e) => {
      if (e.target.closest(".submenu")) return;
      item.classList.toggle("expanded");
    });
  });

  // Settings modal
  const settingsBtn = document.getElementById("settings-btn");
  const settingsModal = document.getElementById("settings-modal");
  const closeSettings = document.getElementById("close-settings");
  settingsBtn.addEventListener("click", () =>
    settingsModal.classList.add("active")
  );
  closeSettings.addEventListener("click", () =>
    settingsModal.classList.remove("active")
  );

  // Notifications modal
  const notificationsBtn = document.getElementById("notifications-btn");
  const notificationsModal = document.getElementById("notifications-modal");
  const closeNotifications = document.getElementById("close-notifications");
  notificationsBtn.addEventListener("click", () =>
    notificationsModal.classList.add("active")
  );
  closeNotifications.addEventListener("click", () =>
    notificationsModal.classList.remove("active")
  );

  // Close modals when clicking outside
  window.addEventListener("click", (e) => {
    if (e.target === settingsModal) settingsModal.classList.remove("active");
    if (e.target === notificationsModal)
      notificationsModal.classList.remove("active");
  });

  // Theme switcher
  const themeOptions = document.querySelectorAll(".theme-option");
  themeOptions.forEach((option) => {
    option.addEventListener("click", () => {
      themeOptions.forEach((opt) => opt.classList.remove("active"));
      option.classList.add("active");
      const theme = option.dataset.theme;
      if (theme === "dark") {
        document.body.classList.add("dark-mode");
        localStorage.setItem("theme", "dark");
      } else if (theme === "light") {
        document.body.classList.remove("dark-mode");
        localStorage.setItem("theme", "light");
      } else {
        if (
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
        ) {
          document.body.classList.add("dark-mode");
        } else {
          document.body.classList.remove("dark-mode");
        }
        localStorage.setItem("theme", "system");
      }
    });
  });

  // Check for saved theme preference
  const savedTheme = localStorage.getItem("theme");
  if (
    savedTheme === "dark" ||
    (savedTheme === "system" &&
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches)
  ) {
    document.body.classList.add("dark-mode");
    document.querySelector(".theme-dark").classList.add("active");
    document.querySelector(".theme-light").classList.remove("active");
    document.querySelector(".theme-system").classList.remove("active");
  } else if (savedTheme === "system") {
    document.querySelector(".theme-system").classList.add("active");
    document.querySelector(".theme-light").classList.remove("active");
    document.querySelector(".theme-dark").classList.remove("active");
  }

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      if (localStorage.getItem("theme") === "system") {
        if (e.matches) document.body.classList.add("dark-mode");
        else document.body.classList.remove("dark-mode");
      }
    });

  // Tab functionality
  const tabs = document.querySelectorAll(".tab");
  const tabCloseButtons = document.querySelectorAll(".tab-close");

  tabs.forEach((tab) => {
    tab.addEventListener("click", (e) => {
      if (e.target.closest(".tab-close")) return;
      tabs.forEach((t) => t.classList.remove("active"));
      tab.classList.add("active");
    });
  });

  tabCloseButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
      e.stopPropagation();
      const tab = e.target.closest(".tab");
      if (
        tab.classList.contains("unsaved") &&
        !confirm("Hi ha canvis no guardats. Esteu segur que voleu tancar?")
      ) {
        return;
      }
      tab.remove();
      if (tab.classList.contains("active")) {
        const remainingTabs = document.querySelectorAll(".tab");
        if (remainingTabs.length > 0) {
          remainingTabs[0].classList.add("active");
        }
      }
      updateScrollArrows(); // NOU: Actualitza les fletxes després de tancar una pestanya
    });
  });

  // --- NOU CODI PER A LES FLETXES DE SCROLL DELS TABS ---
  const tabsContainer = document.getElementById("tabs-container");
  const scrollLeftBtn = document.getElementById("scroll-left-btn");
  const scrollRightBtn = document.getElementById("scroll-right-btn");

  function updateScrollArrows() {
    if (!tabsContainer) return;

    const maxScrollLeft = tabsContainer.scrollWidth - tabsContainer.clientWidth;

    // Mostra o amaga la fletxa esquerra
    scrollLeftBtn.style.display =
      tabsContainer.scrollLeft > 1 ? "flex" : "none";

    // Mostra o amaga la fletxa dreta
    scrollRightBtn.style.display =
      tabsContainer.scrollLeft < maxScrollLeft - 1 ? "flex" : "none";
  }

  // Event listeners per als botons de scroll
  scrollLeftBtn.addEventListener("click", () => {
    tabsContainer.scrollLeft -= 200;
  });

  scrollRightBtn.addEventListener("click", () => {
    tabsContainer.scrollLeft += 200;
  });

  // Actualitza les fletxes quan es fa scroll dins del contenidor
  tabsContainer.addEventListener("scroll", updateScrollArrows);

  // Actualitza les fletxes quan canvia la mida de la finestra
  window.addEventListener("resize", updateScrollArrows);

  // Observador per quan s'afegeixen o s'eliminen tabs
  const observer = new MutationObserver(updateScrollArrows);
  observer.observe(document.querySelector(".tabs"), { childList: true });

  // Crida inicial per comprovar l'estat en carregar la pàgina
  setTimeout(updateScrollArrows, 200);
</script>
