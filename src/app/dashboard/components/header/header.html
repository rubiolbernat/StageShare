<!-- Header -->
<header>
  <div class="header-left">
    <div class="mobile-menu-btn" id="mobile-menu-btn" (click)="toggleAside()">
      <i class="fas"
        ><svg
          class="w-6 h-6 text-gray-800 dark:text-white"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            stroke="currentColor"
            stroke-linecap="round"
            stroke-width="2"
            d="M5 7h14M5 12h14M5 17h14"
          />
        </svg>
      </i>
    </div>
    <!-- NOU CONTENIDOR PER ALS TABS I FLETXES -->
    <div class="tabs-wrapper">
      <button class="scroll-arrow left" id="scroll-left-btn">
        <i class="fas fa-chevron-left"></i>
      </button>
      <div class="tabs-container" id="tabs-container">
        <div class="tabs">
          <div class="tab active">
            Tauler principal
            <span class="tab-close"
              ><i class="fas"
                ><svg
                  class="w-[19px] h-[19px] text-gray-800 dark:text-white"
                  aria-hidden="true"
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke="currentColor"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M6 18 17.94 6M18 18 6.06 6"
                  />
                </svg> </i
            ></span>
          </div>
          <div class="tab unsaved">
            Analítiques
            <span class="tab-close"><i class="fas fa-times"></i></span
            ><span class="tab-unsaved"></span>
          </div>
          <div class="tab">
            Vendes <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
          <div class="tab unsaved">
            Clients <span class="tab-close"><i class="fas fa-times"></i></span
            ><span class="tab-unsaved"></span>
          </div>
          <div class="tab">
            Informes <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
          <div class="tab">
            Configuració
            <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
          <div class="tab">
            Suport <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
          <div class="tab">
            Documentació
            <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
          <div class="tab">
            Finances <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
          <div class="tab">
            Projectes
            <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
          <div class="tab">
            Inventari
            <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
          <div class="tab">
            Equip <span class="tab-close"><i class="fas fa-times"></i></span>
          </div>
        </div>
      </div>
      <button class="scroll-arrow right" id="scroll-right-btn">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
  <div class="header-right">
    <div
      class="header-icon"
      id="notifications-btn"
      (click)="openMessagesModal()"
    >
      <i class="fas"
        ><svg
          class="w-[23px] h-[23px] text-gray-800 dark:text-white"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M17.133 12.632v-1.8a5.406 5.406 0 0 0-4.154-5.262.955.955 0 0 0 .021-.106V3.1a1 1 0 0 0-2 0v2.364a.955.955 0 0 0 .021.106 5.406 5.406 0 0 0-4.154 5.262v1.8C6.867 15.018 5 15.614 5 16.807 5 17.4 5 18 5.538 18h12.924C19 18 19 17.4 19 16.807c0-1.193-1.867-1.789-1.867-4.175ZM8.823 19a3.453 3.453 0 0 0 6.354 0H8.823Z"
          />
        </svg>
      </i>
      <span class="notifications-count">3</span>
    </div>
    <div class="header-icon" id="settings-btn" (click)="openSettingsModal()">
      <i class="fas"
        ><svg
          class="w-[23px] h-[23px] text-gray-800 dark:text-white"
          aria-hidden="true"
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            fill-rule="evenodd"
            d="M9.586 2.586A2 2 0 0 1 11 2h2a2 2 0 0 1 2 2v.089l.473.196.063-.063a2.002 2.002 0 0 1 2.828 0l1.414 1.414a2 2 0 0 1 0 2.827l-.063.064.196.473H20a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2h-.089l-.196.473.063.063a2.002 2.002 0 0 1 0 2.828l-1.414 1.414a2 2 0 0 1-2.828 0l-.063-.063-.473.196V20a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-.089l-.473-.196-.063.063a2.002 2.002 0 0 1-2.828 0l-1.414-1.414a2 2 0 0 1 0-2.827l.063-.064L4.089 15H4a2 2 0 0 1-2-2v-2a2 2 0 0 1 2-2h.09l.195-.473-.063-.063a2 2 0 0 1 0-2.828l1.414-1.414a2 2 0 0 1 2.827 0l.064.063L9 4.089V4a2 2 0 0 1 .586-1.414ZM8 12a4 4 0 1 1 8 0 4 4 0 0 1-8 0Z"
            clip-rule="evenodd"
          />
        </svg>
      </i>
    </div>
    <div class="profile">
      <img
        src="https://randomuser.me/api/portraits/women/44.jpg"
        alt="Profile"
        class="profile-img"
      />
      <span class="profile-name">Anna Pérez</span>
      <div class="profile-dropdown">
        <div class="dropdown-item">El meu perfil</div>
        <div class="dropdown-item">Configuració</div>
        <div class="dropdown-item">Sortir</div>
      </div>
    </div>
  </div>
</header>
<!-- Settings Modal -->
<div class="modal" id="settings-modal" [class.active]="settingsModal()">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Configuració</h3>
      <button class="close-btn" id="close-settings" (click)="closeModals()">
        ×
      </button>
    </div>
    <div class="setting-option">
      <div class="setting-label">Idioma</div>
      <select>
        <option>Català</option>
        <option>Espanyol</option>
        <option>Anglès</option>
        <option>Francès</option>
      </select>
    </div>
    <div class="setting-option">
      <div class="setting-label">Tema</div>
      <div class="theme-selector">
        <div class="theme-option theme-light active" data-theme="light"></div>
        <div class="theme-option theme-dark" data-theme="dark"></div>
        <div class="theme-option theme-system" data-theme="system"></div>
      </div>
    </div>
  </div>
</div>

<!-- Notifications Modal -->
<div class="modal" [class.active]="messagesModal()" id="notifications-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 class="modal-title">Notificacions</h3>
      <button
        class="close-btn"
        id="close-notifications"
        (click)="closeModals()"
      >
        ×
      </button>
    </div>
    <div class="notification-item">
      <p>Tens 3 notificacions noves</p>
    </div>
  </div>
</div>
<script>
  // Toggle aside menu
  const toggleBtn = document.getElementById("toggle-btn");
  const aside = document.getElementById("aside");
  const mobileMenuBtn = document.getElementById("mobile-menu-btn");

  toggleBtn.addEventListener("click", () => {
    aside.classList.toggle("expanded");
    toggleBtn.querySelector("i").classList.toggle("fa-chevron-right");
    toggleBtn.querySelector("i").classList.toggle("fa-chevron-left");
  });

  mobileMenuBtn.addEventListener("click", () => {
    aside.classList.toggle("active");
  });

  // Tancar menú en fer clic fora en mòbil
  document.addEventListener("click", (e) => {
    if (
      window.innerWidth <= 768 &&
      !aside.contains(e.target) &&
      e.target !== mobileMenuBtn
    ) {
      aside.classList.remove("active");
    }
  });

  // Submenús del menú lateral
  const menuItemsWithSubmenu = document.querySelectorAll(
    ".menu-item:has(.submenu)"
  );

  menuItemsWithSubmenu.forEach((item) => {
    item.addEventListener("click", (e) => {
      if (e.target.closest(".submenu")) return;
      item.classList.toggle("expanded");
    });
  });

  // Settings modal
  const settingsBtn = document.getElementById("settings-btn");
  const settingsModal = document.getElementById("settings-modal");
  const closeSettings = document.getElementById("close-settings");
  settingsBtn.addEventListener("click", () =>
    settingsModal.classList.add("active")
  );
  closeSettings.addEventListener("click", () =>
    settingsModal.classList.remove("active")
  );

  // Notifications modal
  const notificationsBtn = document.getElementById("notifications-btn");
  const notificationsModal = document.getElementById("notifications-modal");
  const closeNotifications = document.getElementById("close-notifications");
  notificationsBtn.addEventListener("click", () =>
    notificationsModal.classList.add("active")
  );
  closeNotifications.addEventListener("click", () =>
    notificationsModal.classList.remove("active")
  );

  // Close modals when clicking outside
  window.addEventListener("click", (e) => {
    if (e.target === settingsModal) settingsModal.classList.remove("active");
    if (e.target === notificationsModal)
      notificationsModal.classList.remove("active");
  });

  // Theme switcher
  const themeOptions = document.querySelectorAll(".theme-option");
  themeOptions.forEach((option) => {
    option.addEventListener("click", () => {
      themeOptions.forEach((opt) => opt.classList.remove("active"));
      option.classList.add("active");
      const theme = option.dataset.theme;
      if (theme === "dark") {
        document.body.classList.add("dark-mode");
        localStorage.setItem("theme", "dark");
      } else if (theme === "light") {
        document.body.classList.remove("dark-mode");
        localStorage.setItem("theme", "light");
      } else {
        if (
          window.matchMedia &&
          window.matchMedia("(prefers-color-scheme: dark)").matches
        ) {
          document.body.classList.add("dark-mode");
        } else {
          document.body.classList.remove("dark-mode");
        }
        localStorage.setItem("theme", "system");
      }
    });
  });

  // Check for saved theme preference
  const savedTheme = localStorage.getItem("theme");
  if (
    savedTheme === "dark" ||
    (savedTheme === "system" &&
      window.matchMedia &&
      window.matchMedia("(prefers-color-scheme: dark)").matches)
  ) {
    document.body.classList.add("dark-mode");
    document.querySelector(".theme-dark").classList.add("active");
    document.querySelector(".theme-light").classList.remove("active");
    document.querySelector(".theme-system").classList.remove("active");
  } else if (savedTheme === "system") {
    document.querySelector(".theme-system").classList.add("active");
    document.querySelector(".theme-light").classList.remove("active");
    document.querySelector(".theme-dark").classList.remove("active");
  }

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", (e) => {
      if (localStorage.getItem("theme") === "system") {
        if (e.matches) document.body.classList.add("dark-mode");
        else document.body.classList.remove("dark-mode");
      }
    });

  // Tab functionality
  const tabs = document.querySelectorAll(".tab");
  const tabCloseButtons = document.querySelectorAll(".tab-close");

  tabs.forEach((tab) => {
    tab.addEventListener("click", (e) => {
      if (e.target.closest(".tab-close")) return;
      tabs.forEach((t) => t.classList.remove("active"));
      tab.classList.add("active");
    });
  });

  tabCloseButtons.forEach((button) => {
    button.addEventListener("click", (e) => {
      e.stopPropagation();
      const tab = e.target.closest(".tab");
      if (
        tab.classList.contains("unsaved") &&
        !confirm("Hi ha canvis no guardats. Esteu segur que voleu tancar?")
      ) {
        return;
      }
      tab.remove();
      if (tab.classList.contains("active")) {
        const remainingTabs = document.querySelectorAll(".tab");
        if (remainingTabs.length > 0) {
          remainingTabs[0].classList.add("active");
        }
      }
      updateScrollArrows(); // NOU: Actualitza les fletxes després de tancar una pestanya
    });
  });

  // --- NOU CODI PER A LES FLETXES DE SCROLL DELS TABS ---
  const tabsContainer = document.getElementById("tabs-container");
  const scrollLeftBtn = document.getElementById("scroll-left-btn");
  const scrollRightBtn = document.getElementById("scroll-right-btn");

  function updateScrollArrows() {
    if (!tabsContainer) return;

    const maxScrollLeft = tabsContainer.scrollWidth - tabsContainer.clientWidth;

    // Mostra o amaga la fletxa esquerra
    scrollLeftBtn.style.display =
      tabsContainer.scrollLeft > 1 ? "flex" : "none";

    // Mostra o amaga la fletxa dreta
    scrollRightBtn.style.display =
      tabsContainer.scrollLeft < maxScrollLeft - 1 ? "flex" : "none";
  }

  // Event listeners per als botons de scroll
  scrollLeftBtn.addEventListener("click", () => {
    tabsContainer.scrollLeft -= 200;
  });

  scrollRightBtn.addEventListener("click", () => {
    tabsContainer.scrollLeft += 200;
  });

  // Actualitza les fletxes quan es fa scroll dins del contenidor
  tabsContainer.addEventListener("scroll", updateScrollArrows);

  // Actualitza les fletxes quan canvia la mida de la finestra
  window.addEventListener("resize", updateScrollArrows);

  // Observador per quan s'afegeixen o s'eliminen tabs
  const observer = new MutationObserver(updateScrollArrows);
  observer.observe(document.querySelector(".tabs"), { childList: true });

  // Crida inicial per comprovar l'estat en carregar la pàgina
  setTimeout(updateScrollArrows, 200);
</script>
